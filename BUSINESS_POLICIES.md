# 비즈니스 정책

## 1. 상품 정책

### 1.1 인기 상품
- **기준**: 최근 3일간 판매량
- **노출 개수**: 상위 5개
- **갱신 주기**: 실시간 조회

## 2. 재고 정책

### 2.1 재고 차감
- **차감 시점**: 주문 생성 시
- **복구 시점**: 결제 실패 시

### 2.2 재고 검증
- **검증 시점**:
  - 장바구니 추가 시
  - 장바구니 수량 변경 시
  - 주문 생성 시

## 3. 쿠폰 정책

### 3.1 쿠폰 발급
- **발급 방식**: 선착순
- **중복 발급**: 불가
- **수량 제한**: 쿠폰별 설정

### 3.2 쿠폰 사용
- **사용 가능 조건**:
  - 유효기간 내
  - 미사용 상태
  - 최소 주문 금액 충족 (선택)
- **사용 제한**: 1회만 사용 가능
- **사용 시점**: 결제 시

## 4. 장바구니 정책

### 4.1 장바구니 보관
- **보관 기한**: 무제한
- **수량 제한**: 재고 수량 이내

### 4.2 장바구니 정리
- **자동 삭제**: 주문 완료 시 (장바구니 주문만)
- **재고 검증**: 주문 생성 시 재검증

## 5. 주문 정책

### 5.1 주문 상태
- **PENDING**: 결제 대기 중
- **COMPLETED**: 결제 완료
- **CANCELLED**: 주문 취소

### 5.2 주문 생성
- **재고 차감**: 주문 생성 시점
- **주문 방식**:
  - 장바구니 주문: 장바구니 전체 상품
  - 즉시 구매: 단일 상품

### 5.3 주문 취소
- **취소 가능 조건**: 결제 전 (PENDING 상태)
- **재고 복구**: 취소 시 자동 복구

## 6. 결제 정책

### 6.1 잔액 관리
- **충전 단위**: 10000원 단위
- **충전 제한**: 없음 (설정 가능)

### 6.2 결제 처리
- **결제 순서**:
  1. 주문 검증 (PENDING 상태 확인)
  2. 쿠폰 검증 및 사용 처리
  3. 최종 금액 계산
  4. 잔액 차감
  5. 결제 내역 저장
  6. 주문 상태 변경 (COMPLETED)

### 6.3 결제 실패 처리
- **재고 복구**: 자동 복구
- **주문 상태**: CANCELLED로 변경
- **쿠폰 복구**: 실패 시점에 따라 처리
  - 쿠폰 사용 전: 처리 없음
  - 쿠폰 사용 후: 사용 상태 복구

### 6.4 외부 연동
- **데이터 플랫폼 전송**:
  - 처리 방식: 비동기
  - 실패 처리: 재시도 또는 별도 보상 로직
  - 결제 영향: 전송 실패해도 결제는 완료 처리
